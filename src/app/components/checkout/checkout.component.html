<app-nav-checkout></app-nav-checkout>
<main class="container">
    <form class="row dados center" id="checkout" method="POST">
        <div class="col-md-4">
            <div class="card-header bg-info text-light">
                <img src="../../../../assets/images/caixa-de-correio.png" alt="" srcset="" width="25" height="25">
                <b class="p-4 font-weight-bolder">Dados de Entrega</b>
            </div>
            <app-endereco *ngIf="enderecos.length != 0" [endereco]="enderecoPrincipal"></app-endereco>
            <div *ngIf="enderecos.length == 0" class="text-center mt-2 mb-3">
                <div class="alert alert-warning m-2 p-1">
                    <h5 class="text-center">Cadastre um endereço para prosseguir com as compras...</h5>
                </div>
                <button class="btn btn-success" (click)="abrirModal(novoEndereco)">Cadastrar novo endereço</button>
            </div>
            <a class="btn btn-primary text-light mt-2" *ngIf="enderecos.length != 0" (click)="abrirModal(listaEnderecos)">Alterar endereço</a>
            <app-forma-envio (enviarFormaDeEnvio)="receberFormaDeEnvio($event)"></app-forma-envio>
        </div>
        <div class="col-md-4">
            <div class="card-header bg-info text-light">
                <img src="../../../../assets/images/doacao.svg" alt="" srcset="" width="25" height="25">
                <b class="p-4 font-weight-bolder">Dados de Pagamento</b>
            </div>
            <app-dados-pagamento [validarDadosPagamento]="dadosDePagamento"
                (botaoFinalizarClicado)="finalizarCompra($event, modalDadosIncorretos)"></app-dados-pagamento>
        </div>
        <div class="col-md-4">
            <div class="card-header bg-info text-light">
                <img src="../../../../assets/images/varejo.svg" alt="" srcset="" width="25" height="25">
                <b class="p-4 font-weight-bolder">Resumo da compra</b>
            </div>
            <app-carrinho [frete]="formaEnvio" 
            (enviarCupom)="receberCupom($event)"></app-carrinho>
            <hr>
            <div class="totalCheckout">
                Total {{total.toLocaleString('pt-BR', formato)}}
            </div>

            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-success btn-block" id="btn-finalizar"
                    (click)="validarCampos(modalDadosIncorretos)">Finalizar compra</button>
            </div>
        </div>
    </form>
</main>

<ng-template #novoEndereco>
    <app-cadastro-endereco (novoEndereco)="cadastrarEndereco($event)"></app-cadastro-endereco>
</ng-template>

<ng-template #listaEnderecos>
    <div class="lista-enderecos d-flex flex-column">
        <div class="card ng-scope text-center sticky-top">
            <h5 class="card-header">Escolha o endereço</h5>
        </div>
        <a *ngFor="let item of enderecos" (click)="mudarEndereco(item)">
            <app-endereco [endereco]="item"></app-endereco>
        </a>
        <div class="text-center mt-2 mb-3">
            <button class="btn btn-success" (click)="abrirModal(novoEndereco)">Cadastrar novo endereço</button>
        </div>
    </div>
</ng-template>

<ng-template #modalDadosIncorretos>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Dados não preenchidos corretamente</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p>Verifique se todos os campos estão corretos.</p>
        <p>Preenha todos os dados corretamente para finalizar a compra.</p>
    </div>
</ng-template>

<div class="footer mt-4">
    <app-footer></app-footer>
</div>